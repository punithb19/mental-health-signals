# =============================================================================
# MH-SIGNALS Pipeline Configuration
# =============================================================================
# This config defines the full end-to-end pipeline:
#   post -> classify (intent + concern) -> retrieve -> generate -> validate
#
# Usage:
#   from mhsignals import MHSignalsPipeline
#   pipeline = MHSignalsPipeline.from_config("configs/pipeline.yaml")
#   response = pipeline("I'm struggling with anxiety before my exams.")
# =============================================================================

seed: 42

# --- Classifier checkpoints ---
# These should point to directories containing meta.json + model artifacts
# produced by: python scripts/train.py --task intent/concern ...
intent_checkpoint: results/runs/distilroberta_base_lora_20260222_011210/checkpoint
# Lower = more intent tags (higher recall, more false positives); higher = fewer tags. Tune via evaluate_classifiers.py --calibrate.
intent_threshold: 0.35
concern_checkpoint: results/runs/distilroberta_base_lora_concern_20260222_095012/checkpoint

# --- Knowledge Base ---
kb:
  metadata_jsonl: data/processed/kb/kb_meta.jsonl
  faiss_index: data/processed/kb/kb.faiss
  corpus_jsonl: data/processed/kb/kb_snippets.jsonl
  embeddings_npy: data/processed/kb/kb_embeddings.npy
  processed_dir: data/processed/kb

# --- Retriever ---
# Use DistilRoBERTa to align with classifier embeddings (same family as intent/concern models)
retriever:
  encoder_model: sentence-transformers/all-distilroberta-v1
  topk: 50           # FAISS candidates before re-ranking
  keep: 6            # Snippets passed to generator (more context for better grounding)
  min_similarity: 0.45   # Stricter threshold for more relevant snippets (RAG-enhanced)
  cross_encoder_model: cross-encoder/ms-marco-MiniLM-L-6-v2   # Re-ranks top N for better relevance
  cross_encoder_top_n: 20  # How many FAISS candidates the cross-encoder scores

# --- Generator ---
generator:
  model_name: google/flan-t5-large   # Upgraded: much better instruction-following than base
  device: mps                         # cpu, mps, or cuda
  max_new_tokens: 300
  do_sample: false
  temperature: 0.7
  top_p: 0.9
  max_prompt_chars: 2000

# --- Logging ---
log_dir: logs/interactions
